{{ revisions|paginator }}

{% if revisions.count %}
    <table class="dashboard-table" width="100%">
        <thead>
            <tr>
                <th class="dashboard-revision">Revision</th>
                <th class="dashboard-title">Title</th>
                <th class="dashboard-comment">Comment</th>
                <th class="dashboard-author">Author{% if show_ips %} <button id="show_ips_btn">Toggle IPs</button>{% endif %}</th>
                {% if show_spam_submission %}
                <th class="dashboard-spam">Akismet</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for revision in revisions %}
                {% set previous_id = revision.previous.id %}
                {% set revision_url = revision.document.get_absolute_url() %}
                <tr
                    tabindex="0"
                    class="dashboard-row {% if not previous_id %}dashboard-row-new{% endif %}"
                    data-revision-id="{{ revision.id }}"
                    data-previous-id="{{ previous_id }}"
                    data-view-url="{{ revision_url }}"
                    data-edit-url="{{ revision.document.get_edit_url() }}"
                    data-compare-url="{{ url('wiki.compare_revisions', revision.document.slug, locale=revision.document.locale) }}?from={{ previous_id if previous_id else revision.id }}&amp;to={{ revision.id }}&amp;raw=1"
                    data-revert-url="{{ url('wiki.revert_document', revision.document.slug, revision.id, locale=revision.document.locale) }}"
                    data-history-url="{{ url('wiki.document_revisions', revision.document.slug, locale=revision.document.locale) }}">
                    <td class="dashboard-revision">
                        <a href="{{ url('wiki.revision', revision.document.slug, revision.id) }}">{{ datetimeformat(revision.created, format='datetime') }}</a>
                        <br />
                        <span class="locale">{{ revision.document.locale }}</span>
                        {% if not previous_id %}<span class="new">{{ _('new') }}</span>{% endif %}
                        {% if revision.document.deleted %}<span class="deleted">{{ _('deleted') }}</span>{% endif %}
                    </td>
                    <td class="dashboard-title">
                        <a href="{{ revision_url }}">{{ revision.title }}</a>
                        <span class="dashboard-slug">{{ revision.document.slug }}</span>
                    </td>
                    <td class="dashboard-comment">
                        {{ format_comment(revision) }}
                    </td>
                    <td class="dashboard-author">
                        <a href="{{ revision.creator.get_absolute_url() }}">{{ revision.creator }}</a>
                        {% set revision_ip = revision.revisionip_set.first() %}
                        {% if show_ips and revision_ip %}
                        <span class="revision_ip">
                            <br/>IP: {{ revision_ip.ip }}
                            {% if revision_ip.user_agent %}<br/>User agent: {{ revision_ip.user_agent }}{% endif %}
                            {% if revision_ip.referrer %}<br/>User agent: {{ revision_ip.referrer }}{% endif %}
                            {% set ban_ip_url = '%s?%s' % (url('admin:core_ipban_add'), 'ip=%s' % revision_ip) %}
                            <br/><a class="dashboard-ban-ip-link" href="{{ ban_ip_url }}" target="_blank">{{ _('Ban IP from Editing') }}</a>
                        </span>
                        {% endif %}
                        {% if request.user.is_superuser and revision.creator.active_ban %}
                            <div class="banned">
                                banned {{ datetimeformat(revision.creator.active_ban.date, format='date') }}
                                by {{ revision.creator.active_ban.by }}
                            </div>
                        {% endif %}
                    </td>
                    {% if show_spam_submission %}
                    <td class="dashboard-spam">
                        {% set submissions = revision.akismet_submissions.all() %}
                        {% if submissions.count() > 0 %}
                            <p>Sent as
                            {% for submission in submissions %}
                                {{ submission.type }}
                                at {{ datetimeformat(submission.sent, format='datetime') }}
                                by <a href="{{ submission.sender.get_absolute_url() }}">{{ submission.sender }}</a>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                            </p>
                        {% endif %}
                        {% set spam_submission_url = '%s?%s' % (url('admin:wiki_revisionakismetsubmission_add'), 'revision=%s&type=spam' % revision.id) %}
                        {% set ham_submission_url = '%s?%s' % (url('admin:wiki_revisionakismetsubmission_add'), 'revision=%s&type=ham' % revision.id) %}
                        {{ _('Submit as') }} <a class="button" href="{{ spam_submission_url }}" target="_blank">{{ _('spam') }}</a>
                        <a class="button" href="{{ ham_submission_url }}" target="_blank">{{ _('ham') }}</a>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

{% else: %}

    <p>{{ _('There are no revisions matching this filter set.') }}</p>

{% endif %}

{{ revisions|paginator }}
